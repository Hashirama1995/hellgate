#   Input variables:
#       FMT_GIT_TAG
#       FMT_BUILD_DIR
#       FMT_INSTALL_DIR

cmake_minimum_required (VERSION 3.0)

project(fmtBuild)

include(ExternalProject)

if(MSVC AND NOT (${CMAKE_GENERATOR} MATCHES "Win64"))
    set(FMT_CMAKE_GENERATOR_PLATFORM -A ${CMAKE_GENERATOR_PLATFORM})
else()
    set(FMT_CMAKE_GENERATOR_PLATFORM)
endif()

set(FMT_GIT_REPOSITORY https://github.com/fmtlib/fmt.git)

set(FMT_CONFIGURE_OPTIONS
	-DFMT_DOC=OFF
	-DFMT_TEST=OFF
	-DCMAKE_INSTALL_PREFIX=${FMT_INSTALL_DIR}
    -G ${CMAKE_GENERATOR}
    ${FMT_CMAKE_GENERATOR_PLATFORM}
)

set(FMT_BUILD_DIR_DEBUG ${FMT_BUILD_DIR}/Debug)
file(MAKE_DIRECTORY ${FMT_BUILD_DIR_DEBUG})
set(FMT_CONFIGURE_COMMAND ${CMAKE_COMMAND} ${FMT_CONFIGURE_OPTIONS})
set(FMT_BUILD_COMMAND_DEBUG ${CMAKE_COMMAND} --build ${FMT_BUILD_DIR_DEBUG} --config Debug)
set(FMT_INSTALL_COMMAND_DEBUG ${CMAKE_COMMAND} --build ${FMT_BUILD_DIR_DEBUG} --config Debug --target install)

ExternalProject_Add(
    fmt
    GIT_REPOSITORY ${FMT_GIT_REPOSITORY}
    GIT_TAG ${FMT_GIT_TAG}
    CONFIGURE_COMMAND ${FMT_CONFIGURE_COMMAND} -S . -B ${FMT_BUILD_DIR_DEBUG}
    BUILD_COMMAND ${FMT_BUILD_COMMAND_DEBUG}
    BUILD_IN_SOURCE 1
    INSTALL_COMMAND ${FMT_INSTALL_COMMAND_DEBUG}
)